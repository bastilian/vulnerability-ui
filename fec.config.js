/* eslint-disable no-undef */
const { resolve } = require('path');
const { sentryWebpackPlugin } = require('@sentry/webpack-plugin');

module.exports = {
    appUrl: '/insights/vulnerability',
    debug: true,
    useProxy: process.env.PROXY === 'true',
    proxyVerbose: true,
    interceptChromeConfig: false,
    devtool: 'hidden-source-map',
    plugins: [
        // Put the Sentry Webpack plugin after all other plugins
        ...(process.env.ENABLE_SENTRY
            ? [
                sentryWebpackPlugin({
                    ...(process.env.SENTRY_AUTH_TOKEN && {
                        authToken: process.env.SENTRY_AUTH_TOKEN
                    }),
                    org: 'red-hat-it',
                    project: 'vulnerability-rhel',
                    moduleMetadata: ({ release }) => ({
                        dsn: `https://cb035c73625db2cf00141494a95bdedb@o490301.ingest.us.sentry.io/4508683271077888`,
                        org: 'red-hat-it',
                        project: 'vulnerability-rhel',
                        release
                    })
                })
            ]
            : [])
    ],
    ...(process.env.HOT ? { hotReload: process.env.HOT === 'true' } : { hotReload: true }),
    ...(process.env.port ? { port: parseInt(process.env.port) } : {}),
    moduleFederation: {
        shared: [
            {
                'react-router-dom': {
                    singleton: true,
                    import: false,
                    version: '^6.8.1',
                    requiredVersion: '>=6.0.0 <7.0.0'
                }
            }
        ],
        exposes: {
            './RootApp': resolve(__dirname, './src/AppEntry'),
            './SystemDetail': resolve(__dirname, './src/index.js')
        }
    },
    frontendCRDPath: 'deploy/frontend.yml'
};
